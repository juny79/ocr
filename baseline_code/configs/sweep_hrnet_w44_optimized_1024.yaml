# WandB Sweep Configuration for HRNet-W44 1024px Optimization
# Based on 0.9886 score parameters with fine-tuning
# Target: Surpass 0.9837 leaderboard score

program: runners/train.py
method: bayes  # Bayesian optimization
metric:
  name: val/hmean
  goal: maximize

parameters:
  # Fixed parameters
  preset:
    value: hrnet_w44_optimized_1024
  exp_name:
    value: hrnet_w44_sweep_optimized
  wandb:
    value: true
  trainer.max_epochs:
    value: 13
  
  # Critical parameters for fine-tuning
  
  # Learning Rate (narrow range around optimal)
  models.optimizer.lr:
    distribution: uniform
    min: 0.0010
    max: 0.0016
  
  # Weight Decay
  models.optimizer.weight_decay:
    distribution: uniform
    min: 0.0002
    max: 0.0005
  
  # Scheduler T_max
  models.scheduler.T_max:
    values: [8, 10, 12]
  
  # Postprocessing - Threshold
  models.head.postprocess.thresh:
    distribution: uniform
    min: 0.20
    max: 0.26
  
  # Postprocessing - Box Threshold
  models.head.postprocess.box_thresh:
    distribution: uniform
    min: 0.38
    max: 0.48
  
  # Postprocessing - Box Unclip Ratio
  models.head.postprocess.box_unclip_ratio:
    distribution: uniform
    min: 1.3
    max: 1.6
  
  # Postprocessing - Polygon Unclip Ratio
  models.head.postprocess.polygon_unclip_ratio:
    distribution: uniform
    min: 1.8
    max: 2.1
  
  # Loss - Negative Ratio
  models.loss.negative_ratio:
    distribution: uniform
    min: 2.5
    max: 3.2
  
  # Loss - Prob Weight
  models.loss.prob_map_loss_weight:
    distribution: uniform
    min: 3.0
    max: 4.5
  
  # Loss - Thresh Weight
  models.loss.thresh_map_loss_weight:
    distribution: uniform
    min: 7.0
    max: 9.0
  
  # Loss - Binary Weight
  models.loss.binary_map_loss_weight:
    distribution: uniform
    min: 0.5
    max: 1.0
  
  # CollateFN - Shrink Ratio
  dataloaders.train_dataloader.collate_fn.shrink_ratio:
    distribution: uniform
    min: 0.38
    max: 0.48
  
  # CollateFN - Thresh Min
  dataloaders.train_dataloader.collate_fn.thresh_min:
    distribution: uniform
    min: 0.30
    max: 0.38
  
  # CollateFN - Thresh Max
  dataloaders.train_dataloader.collate_fn.thresh_max:
    distribution: uniform
    min: 0.70
    max: 0.80
  
  # Augmentation - Brightness/Contrast
  datasets.transforms.train_transform.transforms[5].brightness_limit:
    distribution: uniform
    min: 0.28
    max: 0.36
  
  datasets.transforms.train_transform.transforms[5].contrast_limit:
    distribution: uniform
    min: 0.24
    max: 0.32

early_terminate:
  type: hyperband
  min_iter: 8
  eta: 2
  s: 2

command:
  - ${env}
  - python
  - ${program}
  - ${args_no_hyphens}
